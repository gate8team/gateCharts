<!doctype html>
<html>
<head>
	<title>Test task</title>
	<meta charset="utf-8">
</head>
<body style="background: #EBF0F2;">
	<svg id="svg">
        <piece value="15" name="First element" color="#0B86EA"></piece>
        <piece value="30" name="Second element" color="#FFDA36"></piece>
        <piece value="40" name="Third element" color="#CCCCCC"></piece>
        <piece value="15" name="Fourth element" color="#67A008"></piece>
    </svg>
	<script src="./static/js/libs/snap.svg-min.js"></script>
    <!--<script src="./static/js/libs/snap.svg.js"></script>-->
    <script src="./static/js/pathStringBuilder.js"></script>
    <script src="./static/js/piePiece.js"></script>
    <script src="./static/js/pieChart.js"></script>

	<script>
        var pathStringBuilder = new PathStringBuilder()
            pieChart = new PieChart({elementSelector: '#svg'}),
            elements = document.getElementById('svg').getElementsByTagName('piece'),
            percentage = [],
            colors = [];

        for (var i = 0; i < elements.length; i++) {
            percentage.push(parseInt(elements[i].getAttribute('value')));
            colors.push(elements[i].getAttribute('color'));
        }

//        console.log(colors);
//        console.log(percentage);
//        elements.forEach(function(el){
//            console.log(el);
//            percentage.push(el.getAttribute('name'));
//            colors.push(el.getAttribute('color'));
//        });

//        var name = elements[0].hasAttribute('name') ? elements[0].getAttribute('name') : null;
//        var value = elements[0].hasAttribute('value') ? elements[0].getAttribute('value') : null;
//        var color = elements[0].hasAttribute('color') ? elements[0].getAttribute('color') : null;
//        console.log(name);

//        var percentage = [20, 70, 20, 15];
//		var colors = ['#0B86EA', '#FFDA36', '#CCCCCC', '#67A008'];

		var sum = percentage.reduce(function(pv, cv) { return pv + cv; }, 0);

		var minAngle = -90, maxAngle = 90,
			diffAngle = maxAngle - minAngle;

		var i = j = 0;
        pieChart.initChart();

		percentage.forEach(function(el){
			var angle = diffAngle * el / sum;
            var title = 'Piece #' + j;

            var piePiece = new PiePiece(
                    {
                        title: title,
                        value: el,
                        color: colors[j++],
                        startAngle: minAngle,
                        endAngle: (minAngle + angle),
                        pathString: pathStringBuilder.changeAngles(minAngle, minAngle + angle).getPathString({cx: 150, cy: 150, t: 50}).join(''),
                        animatePath: pathStringBuilder.getPathString({outerOffset:8, cx: 150, cy: 150}).join('')
                    }
            );

            pieChart.addPiePiece(piePiece.initPiece(pieChart.getChart()));
            minAngle += angle;
		});
	</script>
</body>
</html>